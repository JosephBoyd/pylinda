import sys

defines = {"PYTHON_VERSION": "%s.%s" % (sys.version_info[0], sys.version_info[1])}

text = open(str("config.h.in"), "r").read() % defines
open(str("config.h"), "w").write(text)

env = Environment(CCFLAGS="-g -Wall -Werror", CPPPATH=["#src/", "#cpp/", "#", "/home/andrew/include", "/usr/include/libxml2"], LIBPATH=[".", "/home/andrew/lib"])
cppenv = Environment(CCFLAGS="-g -Wall -Werror", CPPPATH=["#src/", "#cpp/", "#", "/home/andrew/include", "/usr/include/libxml2"])

Export("env")
Export("cppenv")

clientobjs, serverobjs = SConscript("src/SConscript")
cppclientobjs = SConscript("cpp/SConscript")
pyclientobjs, pyserverobjs = SConscript("python/SConscript")

env.SharedLibrary(target = "linda", source = clientobjs)
cppenv.SharedLibrary(target = "linda++", source = cppclientobjs)
env.SharedLibrary(target = "linda-server", source = serverobjs)

env.SharedLibrary(target = "_linda", source = pyclientobjs, SHLIBPREFIX='', LIBS=["linda", "minimal", "xml2", "python2.5", "readline", "fl"])
env.SharedLibrary(target = "_linda_server", source = pyserverobjs, SHLIBPREFIX='', LIBS=["linda-server", "minimal", "xml2"])